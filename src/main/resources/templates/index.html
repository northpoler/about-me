<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>首页</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" th:href="@{../static/layui/css/layui.css}"/>
    <script type="text/javascript" src="http://hovertree.com/ziyuan/jquery/jquery-1.11.3.min.js"></script>
</head>
<body style="background-color: lightgoldenrodyellow">

<div class="layui-row" style="text-align: center;font-size: larger">
    <div class="layui-col-md3">&nbsp;</div>
    <div class="layui-col-md6">
        <div class="layui-card" style="background-color: lightcyan">
            <div class="layui-card-header">你好</div>
            <div class="layui-card-body" style="color: deeppink">
                欢迎来访<br>
            </div>
        </div>
        <!--<div class="layui-card" style="background-color: lightcyan">
            <div class="layui-card-header" id="countDownTitle">
            </div>
            <div class="layui-card-body" id="countDown" style="color: deeppink">
            </div>
        </div>
        <div style="text-align: center">
            <br/>
            <button class="layui-btn layui-btn-lg layui-btn-radius layui-btn-danger" onclick="down()"><i
                    class="layui-icon layui-icon-tread"></i>&nbsp;0
            </button>
            <button class="layui-btn layui-btn-lg layui-btn-radius layui-btn-normal" onclick="like()"><i
                    class="layui-icon layui-icon-praise"></i>&nbsp;<span id="like">0</span></button>
            <br/><br/><br/>
            <button class="layui-btn layui-btn-lg layui-btn-radius layui-btn-warm" id="stop"><i
                    class="layui-icon layui-icon-pause"></i>&nbsp;结束刷赞
            </button>
        </div>-->
    </div>
    <div class="layui-col-md3">&nbsp;</div>
</div>

<div style="position: fixed;bottom: 6%;width: 100%;font-size: larger;text-align: center;color: gray;">
    <a th:href="@{/search}"><i>www.jianbing.pro</i></a>
</div>

</body>
<script th:src="@{../static/layui/layui.js}"></script>
<script type="text/javascript">

    var message = [[${likes}]];
    $("#like").text(message);

    $("#stop").hide();
    /*$("#customCountDown").hide();*/

    var userLikes = 0;


    layui.use('layer', function () {
        var layer = layui.layer;
    });

    function down() {
        layer.open({
            title: '提示',
            anim: 6
            , content: '抱歉，系统故障！'
        });
    }

    layui.use('util', function () {
        var util = layui.util;

        //执行
        util.fixbar({
            bar1: "<i style=\"font-size: larger;color: deeppink;font-weight: bolder\" class=\"layui-icon layui-icon-face-smile-b layui-anim layui-anim-rotate layui-anim-loop\"></i>",
            bgcolor: "lightgoldenrodyellow",
            css: {right: "10%", bottom: "10%"}
            , click: function (type) {
                console.log(type);
                if (type === 'bar1') {
                    layer.msg('感谢你的支持', {
                        time: 2000,
                        btn: ['赞助一下', '残忍关闭'],
/*                        btn1: function () {
                            $.getJSON('/support/alipay', function(json){
                                layer.photos({
                                    photos: json
                                    ,anim: 5 //0-6的选择，指定弹出图片动画类型，默认随机（请注意，3.0之前的版本用shift参数）
                                });
                            });
                        },*/
                        btn1: function () {
                            $.getJSON('/support/weChat', function(json){
                                layer.photos({
                                    photos: json
                                    ,anim: 5 //0-6的选择，指定弹出图片动画类型，默认随机（请注意，3.0之前的版本用shift参数）
                                });
                                layer.msg('长按识别二维码', {offset: '100px', anim: 0, time: 300});
                            });
                        }
                    });
                }
            }
        });
    });
    function like() {
        layer.msg('点赞成功！', {offset: '100px', anim: 0, time: 300});
        var test = $("#like").text();
        var before = parseInt(test);
        userLikes++;
        /*var next = before + 1;
        $("#up").text(next);*/

        $.ajax({
            type: 'GET',
            dataType: 'json',
            url: '/like/insert',
            data: {"count": before},
            cache: false,
            async: true,
            success: function (data) {
                $("#like").text(data);
            }
        });

        if (userLikes == 10) {
            layer.confirm('检测到你已连续点赞10次，是否开启刷赞模式？', {icon: 3, title: '提示'}, function (index) {
                upup();
                layer.close(index);
                $("#stop").show();
            });
        }

    }

    function upup() {
        ref = setInterval(function () {
            like();
        }, 10);
        $("#stop").click(function () {
            layer.msg('刷赞模式即将停止', {offset: '100px', anim: 0, time: 2500});
            clearInterval(ref)
            $("#stop").hide();
            userLikes = 0;
        })
    }

    window.onload = function (ev) {
        getCountdown();
    };

    function getCountdown() {
        $.ajax({
            type: 'GET',
            dataType: 'json',
            url: '/countdown/get',
            data: {},
            cache: false,
            async: true,
            success: function (data) {
                titleA = data[0].title;
                endTimeA = data[0].endTime;
                daysA = data[0].days;
                titleB = data[1].title;
                endTimeB = data[1].endTime;
                if (endTimeA.length<6){
                    endTimeA[5] = 0;
                }
                if (endTimeB.length<6){
                    endTimeB[5] = 0;
                }
                daysB = data[1].days;
                endA = new Date(endTimeA[0],endTimeA[1]-1,endTimeA[2],endTimeA[3],endTimeA[4],endTimeA[5]);
                endB = new Date(endTimeB[0],endTimeB[1]-1,endTimeB[2],endTimeB[3],endTimeB[4],endTimeB[5]);
                countdown();
            }
        });
    }

    function countdown() {
        var now = new Date();
        var title = titleA;
        if (now > endA){
            endA = endB;
            title = titleB;
        }
        var today = now;
        var stopTime = endA;
        var shenyu = stopTime.getTime() - today.getTime(),//倒计时毫秒数
            shengyuD = parseInt(shenyu / (60 * 60 * 24 * 1000)),//转换为天
            D = parseInt(shenyu) - parseInt(shengyuD * 60 * 60 * 24 * 1000),//除去天的毫秒数
            shengyuH = parseInt(D / (60 * 60 * 1000)),//除去天的毫秒数转换成小时
            H = D - shengyuH * 60 * 60 * 1000,//除去天、小时的毫秒数
            shengyuM = parseInt(H / (60 * 1000));//除去天的毫秒数转换成分钟
        var S = parseInt((shenyu - shengyuD * 60 * 60 * 24 * 1000 - shengyuH * 60 * 60 * 1000 - shengyuM * 60 * 1000) / 1000)//除去天、小时、分的毫秒数转化为秒
        var MS = parseInt(shenyu - shengyuD * 60 * 60 * 24 * 1000 - shengyuH * 60 * 60 * 1000 - shengyuM * 60 * 1000 - S * 1000)//除去天、小时、分的毫秒数转化为秒
        MS = (Array(3).join('0') + MS).slice(-3);
        document.getElementById("countDown").innerHTML = (shengyuD + "天" + shengyuH + "小时" + shengyuM + "分" + S + "秒" + MS + "毫秒" + "<br>");
        $("#countDownTitle").html("现在距离李建兵"+title+"还有：");
        setTimeout(countdown, 33);
    }
</script>
</html>